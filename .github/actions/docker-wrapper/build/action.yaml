name: "Docker Build (Local Registry & Save Archive)"
description: "Builds Docker image for local registry, saves as image.tar archive, and prints debug info."

runs:
  using: "composite"
  steps:

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: Build Docker image with Buildx
      uses: docker/build-push-action@v5
      with:
        context: ${{ env.GHA_CICD_DOCKER_CONTEXT }}
        file: ${{ env.GHA_CICD_DOCKERFILE_PATH }}
        tags: ${{ env.GHA_CICD_DOCKER_IMAGE }}
        build-args: ${{ env.GHA_CICD_DOCKER_BUILD_ARGS }}
        push: false
        load: true

    - name: Save Docker image as tar archive
      shell: bash
      run: |
        echo "::group::Saving Docker image as image.tar"
        docker images
        docker save -o image.tar "$GHA_CICD_DOCKER_IMAGE"
        echo "Docker image saved to image.tar"
        echo "::endgroup::"